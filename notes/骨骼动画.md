## 骨骼动画原理


## 骨骼动画实现中遇到的问题

#### u_bones传参错误
我用vector定义u_bones，glsl用mat4 数组接受，发现传不过去。最后改用 glm::mat4定义u_bones[100]，传参数正确。

#### fbx模型的手脚是反的
试过不少类型的模型，有obj，fbx，glb，gltf等，发现大部分fbx模型的手脚是反的，这令我很奇怪，然后我就各种查找问题。

![image-20240711075204299](/Users/bowenzou/Library/Application Support/typora-user-images/image-20240711075204299.png)

最后打印数据发现多了很多关键帧节点。

```c++
dest.name RootNode
 dest.name Stormtrooper
 dest.name mixamorig:Hips
 dest.name mixamorig:Spine_$AssimpFbx$_Translation
 dest.name mixamorig:Spine_$AssimpFbx$_PreRotation
 dest.name mixamorig:Spine
 dest.name mixamorig:Spine1
 dest.name mixamorig:Spine2
 dest.name mixamorig:Neck_$AssimpFbx$_Translation
 dest.name mixamorig:Neck_$AssimpFbx$_PreRotation
 dest.name mixamorig:Neck
 dest.name mixamorig:Head
 dest.name mixamorig:HeadTop_End
 dest.name mixamorig:LeftShoulder_$AssimpFbx$_Translation
 dest.name mixamorig:LeftShoulder_$AssimpFbx$_PreRotation
 dest.name mixamorig:LeftShoulder
 dest.name mixamorig:LeftArm_$AssimpFbx$_Translation
 dest.name mixamorig:LeftArm_$AssimpFbx$_PreRotation
 dest.name mixamorig:LeftArm
 dest.name mixamorig:LeftForeArm_$AssimpFbx$_Translation
 dest.name mixamorig:LeftForeArm_$AssimpFbx$_PreRotation
 dest.name mixamorig:LeftForeArm
 dest.name mixamorig:LeftHand_$AssimpFbx$_Translation
 dest.name mixamorig:LeftHand_$AssimpFbx$_PreRotation
 dest.name mixamorig:LeftHand
 dest.name mixamorig:LeftHandThumb1_$AssimpFbx$_Translation
 dest.name mixamorig:LeftHandThumb1_$AssimpFbx$_PreRotation
 dest.name mixamorig:LeftHandThumb1
 dest.name mixamorig:LeftHandThumb2_$AssimpFbx$_Translation
 dest.name mixamorig:LeftHandThumb2_$AssimpFbx$_PreRotation
 dest.name mixamorig:LeftHandThumb2
 dest.name mixamorig:LeftHandThumb3_$AssimpFbx$_Translation
 dest.name mixamorig:LeftHandThumb3_$AssimpFbx$_PreRotation
```

这是assmip在处理fbx模型时把关键帧处理成节点了，这样会导致在模型动画矩阵计算中累乘不正确的矩阵导致的，解决方法是在import对象添加一行：这就不会生成关键帧节点。

```c++
Assimp::Importer importer;
importer.SetPropertyBool(AI_CONFIG_IMPORT_FBX_PRESERVE_PIVOTS, false);
```



